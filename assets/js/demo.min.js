function isJSON(str) {
    if (typeof str == 'string') {
        try {
            return JSON.parse(str);
					} catch(e) {
            return str
        }
    }
}
Storage.prototype.setExpire=(key, value, expire) =>{
    let obj={
        data:value,
        time:Date.now(),
        expire:expire
    };
    localStorage.setItem(key,JSON.stringify(obj));
}
Storage.prototype.getExpire= key =>{
    let val =localStorage.getItem(key);
    if(!val){
        return val;
    }
    val =JSON.parse(val);
    if(Date.now()-val.time>val.expire){
        localStorage.removeItem(key);
        return null;
    }
    return val.data;
}
function cache_ajax(requests){
	requests["xhrFields"] = {withCredentials: true}
	requests["crossDomain"] = true
	var url = requests["url"]
	sp = url.indexOf("//")+2
	url = url.substring(sp)
	sp = url.indexOf("/")+1
	url = url.substring(sp)
	if (requests["type"].toUpperCase() == "POST"){
		postdata = requests["data"]
		if(typeof postdata=='object'){
			str = ""
			for (var key in postdata) {
			　　item = postdata[key]
				str += key + "=" + item + "&"
			}
			postdata = str
		}
		url += "|" + postdata
	}
	console.log("Cache:"+url)
	if(!window.localStorage){
		$.ajax(requests)
	}else{
	mycache = localStorage.getExpire(url)
	if(mycache){
		mycache = isJSON(mycache)
		thefunction = requests["success"]
		if(thefunction){
			thefunction(mycache)
		}
		thefunction = requests["complete"]
		if(thefunction){
			thefunction(mycache)
		}
	}else{
			var thefunction = requests["success"]
			if(thefunction){
				requests["success"] = function(data){
					thefunction(data)
					if(typeof data=='object'){
						data = JSON.stringify(data)
					}
					localStorage.setExpire(url,data,300000);
				}
				$.ajax(requests)
			}else{
				var thefunction = requests["complete"]
				if(thefunction){
					requests["complete"] = function(data){
						thefunction(data)
						if(typeof data=='object'){
							data = JSON.stringify(data)
						}
						localStorage.setExpire(url,data,300000);
					}
					$.ajax(requests)
				}else{
					$.ajax(requests)
				}
			}
		}
	}
}

function getQueryVariable(variable)
    {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if(pair[0] == variable){return pair[1];}
      }
    
    }
function clear(){
	localStorage.clear()
}
console.log("诶诶诶，就说你呢，瞅啥呢，别给老娘瞎瞅啊！感谢你使用Risacal DNS System哈！")